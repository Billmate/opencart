<?xml version="1.0" encoding="utf-8"?>
<modification>
    <name>Permission Compatibility Fix</name>
    <author>Boxedsolutions Skaraborg</author>
    <link>http://www.billmate.se</link>
    <version>1.1.1</version>
    <code>permission_compatibility_fix</code>
    <file path="system/library/cart/user.php">
        <operation info="fix for 2.3.0.x">
            <search position="replace"><![CDATA[return in_array($value, $this->permission[$key]);]]></search>
            <add><![CDATA[
			$part = explode('/', $value);
			unset($part[0]);
			return (in_array($value, $this->permission[$key]) || in_array(implode('/', $part), $this->permission[$key])) ? true: false;
			]]></add>
        </operation>
    </file>
    <file path="system/engine/action.php">
        <operation info="Fix include old plugin">
            <search position="replace"><![CDATA[$file = DIR_APPLICATION . 'controller/' . implode('/', $parts) . '.php';]]></search>
            <add>
                <![CDATA[
                    $file = DIR_APPLICATION . 'controller/' . implode('/', $parts) . '.php';
                    if(!is_file($file) && (isset($parts[0]) && $parts[0] == 'extension')){
                        unset($parts[0]);
                        $file = DIR_APPLICATION . 'controller/' . implode('/', $parts) . '.php';
                    }
                ]]>
            </add>
        </operation>
    </file>
</modification>
